# Risk Assessment Agent

## Purpose
This agent performs financial risk analysis, threat identification, quantitative risk scoring, and generates AI-powered risk reports using Claude Bedrock.

---

## 1. Directory Structure

- `routes/v1/risk_routes.py`: Defines risk assessment API endpoints
- `models/risk.py`: Request/response schemas
- `services/risk_service.py`: Business logic, Bedrock integration
- `services/bedrock_service.py`: Bedrock Claude integration
- `config.py`: Model, AWS, and environment configuration

---

## 2. Environment Configuration

Create a `.env` file (or copy from `.env-template`):
```
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_DEFAULT_REGION=ap-southeast-1
CONVERSATION_CHAT_MODEL_NAME=claude-37-sonnet
LLM_MAX_TOKENS=8192
LLM_TOP_P=0.5
LLM_TEMPERATURE=0.5
```

---

## 3. Running the Backend

**With Docker:**
```sh
docker-compose up --build
```

**Or run locally:**
```sh
cd app/riskassessment
uvicorn main:app --reload
```

---

## 4. Main APIs

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST   | `/api/v1/risk/assess` | Perform comprehensive risk assessment |
| GET    | `/api/v1/risk/monitor/{entity_id}` | Get risk monitoring status |
| POST   | `/api/v1/risk/alert/webhook` | Receive alerts from external systems |
| GET    | `/api/v1/risk/score/history/{entity_id}` | Get risk score history |
| GET    | `/api/v1/risk/market-data` | Get latest market data |

---

## 5. Quick API Test Example

**Example:**
```sh
curl -X POST http://localhost:8080/api/v1/risk/assess \
  -H "Content-Type: application/json" \
  -d '{
    "entity_id": "123456",
    "entity_type": "corporate",
    "financials": {"revenue": 1000000, "debt": 200000, "profit": 120000},
    "market_data": {"stock_price": 45.2, "exchange_rate": 24500},
    "custom_factors": {"sector": "banking"}
  }'
```

**Expected response:**
- The `ai_report` field contains the risk analysis generated by Claude Bedrock (in Vietnamese).

---

## 6. Notes
- Ensure AWS environment variables are correct and have Bedrock access.
- You can test APIs via Swagger UI: http://localhost:8080/docs
- If you get region/key errors, check your `.env` file and docker-compose configuration.

---

## 7. Extensions
- Integrate alerting, store history in DB, or expand the AI prompt as needed for your use case. 